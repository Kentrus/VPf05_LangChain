
# Learning Assistant Spec — LangChain Project

## 1. Цель проекта

Создать учебного ассистента на Python с использованием LangChain, который помогает ученику:

1. Превращать учебные тексты в понятные конспекты и вопросы для самопроверки (Цепочка А — «Учебный резюмер»).  
2. Проверять свои ответы на эти вопросы, получать развёрнутый фидбэк, оценку и пример идеального ответа (Цепочка Б — «Проверка ответов ученика»).

Проект рассчитан на консольное использование (CLI), с понятными логами и конфигурацией через `.env`.

---

## 2. Технологии и общие требования

- Язык: **Python 3**.  
- Библиотеки:
  - `langchain` (актуальная версия),
  - `langchain-openai` или аналогичный коннектор к LLM (можно поменять, но структура та же),
  - `python-dotenv` для загрузки `.env`.
- Модель LLM:
  - по умолчанию — любая совместимая Chat‑модель (например, OpenAI `gpt-4o-mini` или аналог),
  - выбор модели и ключа — через `.env` и `config.py`.

### Секреты и конфигурация

Все секреты (API‑ключи, название модели и т.п.) должны храниться в `.env` в корне проекта и **не должны** быть зашиты в код.

Пример `.env`:

```env
OPENAI_API_KEY=your_api_key_here
OPENAI_MODEL=gpt-4o-mini
```

Модуль `config.py` отвечает за:

- загрузку `.env` (через `python-dotenv`),
- чтение переменных окружения (`OPENAI_API_KEY`, `OPENAI_MODEL`),
- создание объекта LLM для LangChain,
- хранение текстов системных промптов (см. ниже).

---

## 3. Структура проекта

Рекомендуемая структура каталогов и файлов:

```text
.
├── .env                    # секреты (не в git)
├── learning_assistant_spec.md
├── config.py               # конфигурация, LLM, системные промпты
├── chains
│   ├── __init__.py
│   ├── resumer.py          # Цепочка А — учебный резюмер
│   └── answer_checker.py   # Цепочка Б — проверка ответов
└── main.py                 # CLI-интерфейс
```


---

## 4. Системные промпты (общая логика)

В `config.py` должны быть определены **две текстовые константы**:

- `LEARNING_SUMMARIZER_SYSTEM_PROMPT` — системный промпт для цепочки А.
- `LEARNING_ANSWER_CHECKER_SYSTEM_PROMPT` — системный промпт для цепочки Б.

Эти константы должны использоваться как **system‑сообщения** или как верхняя часть `PromptTemplate` / `ChatPromptTemplate` во всех промптах соответствующих цепочек.

### 4.1. LEARNING_SUMMARIZER_SYSTEM_PROMPT (Цепочка А)

```text
Ты — опытный преподаватель и методист, который помогает ученикам разбираться в сложных материалах простыми словами.
Твоя основная задача — превращать длинные учебные тексты в понятные, структурированные конспекты и список вопросов для самопроверки.

Принципы работы:
- Объясняй так, как будто ученик — новичок и видит тему впервые.
- Используй простой, разговорный язык без лишнего профессионального жаргона. Если используешь термин, кратко объясни его по‑человечески.
- Структурируй ответы: дели текст на блоки с явными подзаголовками и списками.
- Выделяй главное: ключевые понятия, шаги/алгоритмы и практические примеры.
- Избегай воды, повторов и общих фраз “ни о чём”.

Формат работы с учебным текстом:
1. Сначала делай короткое резюме (2–4 предложения), где отвечаешь на вопросы:
   - о чём этот текст;
   - какие основные темы и идеи;
   - что главное должен унести ученик.
2. Затем выделяй ключевые идеи в виде трёх блоков:
   - «Понятия»: список терминов и кратких объяснений простым языком;
   - «Шаги/алгоритмы»: последовательности действий или логики, если они есть в тексте;
   - «Примеры»: 1–2 понятных примера из жизни или практики, которые помогают почувствовать, как это работает.
3. На основе ключевых идей формируй вопросы для самопроверки. Вопросы должны проверять понимание смысла, а не заучивание текста.

Требования к вопросам:
- 3–5 вопросов на материал средней длины;
- без вариантов ответа;
- каждый вопрос в отдельной строке;
- формулировки простые и конкретные, без двусмысленностей;
- вопросы должны охватывать разные аспекты: определения, шаги, примеры, практическое применение.

Всегда соблюдай структуру и ясность:
- не добавляй вступительных и заключительных “водных” фраз;
- не обращайся к ученику по имени и не спрашивай уточнений — работай только с тем текстом, который дан;
- не придумывай новых фактов, которых нет в тексте, если это не здравый пример или аналогия для объяснения.
```


### 4.2. LEARNING_ANSWER_CHECKER_SYSTEM_PROMPT (Цепочка Б)

```text
Ты — внимательный преподаватель и наставник, который помогает ученику осознанно учиться и улучшать свои ответы.
Твоя основная задача — по вопросу, контексту и ответу ученика:
1) оценить, насколько ответ корректен и полно раскрывает тему,
2) дать развёрнутый, но понятный фидбэк,
3) показать пример идеального ответа.

Принципы работы:
- Сохраняй уважительный, поддерживающий тон, даже если ответ слабый.
- Всегда сначала отмечай сильные стороны (что сделано правильно), затем мягко указывай на ошибки и пробелы.
- Говори простым языком, без лишней терминологии. Если используешь термин — кратко объясни его.
- Будь конкретен: вместо «ответ поверхностный» поясни, чего именно не хватает.

Формат анализа ответа:
1. «Анализ»:
   - кратко опиши, отвечает ли ученик на сам вопрос,
   - насколько ответ точен и полный,
   - на что больше похож: на уверенное понимание или на угадывание.
2. «Плюсы»:
   - перечисли конкретные сильные моменты ответа (например, «верно определён термин», «правильно указан порядок шагов»).
3. «Минусы»:
   - перечисли, чего не хватает, какие важные части не раскрыты, где логические ошибки или путаница.
4. «Оценка»:
   - оцени ответ по шкале от 1 до 5 в формате `X/5`;
   - обязательно добавь короткий комментарий, почему именно такая оценка,
     и что нужно добавить или улучшить, чтобы получить 5/5.
5. «Идеальный ответ»:
   - сформулируй пример ответа «идеального ученика» — как бы кратко и понятно ответил профессионал,
   - используй простой язык и логичную структуру, чтобы по этому ответу можно было учиться.

Работай строго в рамках контекста:
- контекст (резюме и ключевые идеи) важнее “общих знаний” — не уходи в сторону, если это не связано с данным материалом;
- не добавляй факты, которых нет в контексте, если они не очевидны и не необходимы для базового понимания;
- цель — не показать «умный» ответ, а помочь ученику понять, что улучшить.

Всегда следуй заданному формату вывода: блоки «Анализ», «Плюсы», «Минусы», «Оценка», «Идеальный ответ» должны быть явно выделены и идти в указанном порядке.
```


---

## 5. Цепочка А — «Учебный резюмер»

### 5.1. Назначение

Преобразовать учебный текст в:

- краткое резюме,
- структурированные ключевые идеи,
- список вопросов для самопроверки.


### 5.2. Вход и выход

**Вход:**

- `input_text: str` — полный текст урока/статьи/конспекта.

**Выход:**

Словарь вида:

```python
{
  "summary": str,       # краткое резюме
  "key_points": str,    # структурированные ключевые идеи
  "questions": List[str]  # список вопросов строками
}
```


### 5.3. Внутренняя логика (шаги)

Реализовать три последовательных LLM‑шагa (можно через три `LLMChain`):

1. **Резюме текста**
    - На вход: `input_text`.
    - Использует `LEARNING_SUMMARIZER_SYSTEM_PROMPT` + промпт для генерации краткого резюме (2–4 предложения).
    - На выход: `summary: str`.
2. **Выделение ключевых идей**
    - На вход: `input_text`, `summary`.
    - Использует тот же системный промпт + промпт для структурирования в три блока:
        - «Понятия»,
        - «Шаги/алгоритмы»,
        - «Примеры».
    - На выход: `key_points: str` (структурированный текст).
3. **Генерация вопросов**
    - На вход: `key_points`.
    - Использует системный промпт и отдельный промпт:
        - сгенерировать 3–5 вопросов,
        - без вариантов ответов,
        - каждый вопрос на новой строке.
    - На выход: `questions_raw: str` → парсится в `List[str]`.

### 5.4. Публичный интерфейс цепочки А

Модуль `chains/resumer.py` должен предоставлять функцию:

```python
def build_resumer_output(input_text: str) -> dict:
    ...
```

Которая:

1. По очереди вызывает три внутренних шага.
2. Возвращает словарь:
```python
{
  "summary": summary,
  "key_points": key_points,
  "questions": questions_list,
}
```

Где `questions_list` — список строк, очищенный от пустых строк и лишних пробелов.

---

## 6. Цепочка Б — «Проверка ответов ученика»

### 6.1. Назначение

Проверить конкретный ответ ученика на один из вопросов из цепочки А и выдать:

- анализ ответа,
- плюсы и минусы,
- оценку по 5‑балльной шкале,
- пример идеального ответа.


### 6.2. Вход и выход

**Вход:**

- `question: str` — один вопрос из `questions` цепочки А.
- `user_answer: str` — ответ ученика.
- `context: str` — контекст (обычно конкатенация `key_points` + `summary` из цепочки А).

**Выход:**

Структурированный текст с блоками (как одна строка, форматируемая для вывода в консоль):

- `Анализ: ...`
- `Плюсы: ...`
- `Минусы: ...`
- `Оценка: X/5 — ...`
- `Идеальный ответ: ...`


### 6.3. Внутренняя логика

Использовать один `LLMChain` с:

- системным промптом `LEARNING_ANSWER_CHECKER_SYSTEM_PROMPT`,
- промптом, который:
    - принимает `question`, `user_answer`, `context`,
    - даёт чёткие инструкции по формату.

Формат вывода:

```text
Анализ:
...

Плюсы:
...

Минусы:
...

Оценка:
X/5 — краткое объяснение

Идеальный ответ:
...
```


### 6.4. Публичный интерфейс цепочки Б

Модуль `chains/answer_checker.py` должен предоставлять функцию:

```python
def check_answer(question: str, user_answer: str, context: str) -> str:
    ...
```

Которая:

- вызывает LLM с правильным системным промптом и шаблоном,
- возвращает строку с уже отформатированными блоками.

---

## 7. main.py — CLI и логирование

### 7.1. Основной сценарий

`main.py` должен реализовывать следующий сценарий:

1. **Инициализация:**
    - Загрузить `.env` (через `python-dotenv`).
    - Инициализировать LLM из `config.py`.
    - В логах показать:
        - `[INFO] Конфигурация загружена.`
        - `[INFO] Используемая модель: <имя модели>.`
2. **Получение текста урока:**
    - Попросить пользователя вставить/ввести текст урока в консоль (одной строкой или многострочным вводом — на усмотрение разработчика).
    - Лог: `[А] Получен текст урока, запускаю цепочку резюмирования...`.
3. **Запуск цепочки А:**
    - Вызвать `build_resumer_output(input_text)`.
    - По ходу выполнения в логах показать:
        - `[А] Начинаю построение резюме...`
        - `[А] Резюме получено.`
        - `[А] Выделяю ключевые идеи...`
        - `[А] Ключевые идеи готовы.`
        - `[А] Генерирую вопросы для самопроверки...`
        - `[А] Вопросы сгенерированы: N шт.`
4. **Вывод результата А пользователю:**
    - Заголовок `=== РЕЗЮМЕ ===` и вывод `summary`.
    - Заголовок `=== КЛЮЧЕВЫЕ ИДЕИ ===` и вывод `key_points`.
    - Заголовок `=== ВОПРОСЫ ДЛЯ САМОПРОВЕРКИ ===` и пронумерованный список вопросов.
5. **Переход к цепочке Б:**
    - Если список вопросов пуст — вывести лог и завершить:
        - `[Б] Вопросы не сгенерированы, проверка ответов невозможна.`
    - Если вопросы есть:
        - Показать лог: `[Б] Переходим к проверке ответа ученика.`
        - Предложить выбрать номер вопроса (1..N).
        - Показать выбранный вопрос.
        - Попросить ввести ответ ученика в консоль.
6. **Запуск цепочки Б:**
    - Сформировать `context`, объединяя `key_points` и `summary`.
    - Показать лог: `[Б] Анализирую ответ ученика...`
    - Вызвать `check_answer(question, user_answer, context)`.
    - После получения ответа:
        - Лог: `[Б] Оценка и идеальный ответ получены.`
7. **Вывод результата Б пользователю:**
    - Заголовок `=== РАЗБОР ОТВЕТА ===`.
    - Вывести текст, полученный из `check_answer(...)` (с блоками «Анализ», «Плюсы», «Минусы», «Оценка», «Идеальный ответ»).

### 7.2. Логирование

- Можно использовать модуль `logging` или простые `print()` с префиксами:
    - `[INFO]` — общая информация,
    - `[А]` — шаги цепочки А,
    - `[Б]` — шаги цепочки Б.
- Не логировать содержимое API‑ключей и другие секреты.

---

## 8. Требования к качеству кода

- Соблюдать читаемость: понятные имена функций и переменных.
- Краткие, но информативные комментарии возле ключевых участков логики.
- Минимальные проверки входных данных (например, проверка, что текст не пустой, что выбрано корректное число вопроса и т.п.).
- Код должен быть пригоден для дальнейшего развития:
    - потенциальная замена модели,
    - чтение текстов из файлов вместо консоли,
    - добавление новых цепочек.

---

## 9. Инструкция для Cursor

При разработке проекта:

1. Прочитай внимательно этот файл `learning_assistant_spec.md`.
2. Создай файлы и структуру проекта строго в соответствии с описанием.
3. Реализуй:
    - `config.py` с:
        - загрузкой `.env`,
        - инициализацией LLM,
        - константами `LEARNING_SUMMARIZER_SYSTEM_PROMPT` и `LEARNING_ANSWER_CHECKER_SYSTEM_PROMPT`.
    - `chains/resumer.py` с функцией `build_resumer_output`.
    - `chains/answer_checker.py` с функцией `check_answer`.
    - `main.py` с CLI‑логикой и логами по шагам.
4. Убедись, что проект можно запустить командой:
```bash
python main.py
```

и пройти весь сценарий:
ввод текста → конспект + вопросы → выбор вопроса → ввод ответа → разбор и оценка.
